(function(){function f(){"function"!==typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a});var c=f.ErrorCodes;this.errorCode=c.ERR_NOERROR;this.errorString="";this.params=this.redirect=null;this.run=function(a){this.runECMAScriptTest()||(this.redirect="browser.html",a(!1));this.runHTML5Test()||(this.redirect="browser.html",a(!1));if(/^https?:$/.test(window.location.protocol))this.runServerTest(a);else try{var b=this;$.getJSON("resources/systemcheck/test.json",
function(){a(!0)}).fail(function(){b.errorCode=c.ERR_FILE_ACCESS;b.redirect="offline.html";a(!1)})}catch(g){this.errorCode=c.ERR_FILE_ACCESS,this.redirect="offline.html",a(!1)}};this.runECMAScriptTest=function(){return!Object.defineProperty||!JSON.stringify||!JSON.parse?(this.errorCode=c.ERR_ECMASCRIPT_SUPPORT,!1):!0};this.runHTML5Test=function(){for(var a in this.modernizrFeatures)if(!Modernizr[a])return this.errorCode=c.ERR_HTML5_SUPPORT,this.errorString=this.modernizrFeatures[a],!1;return!0};this.runServerTest=
function(a){var b=this;$.getJSON("resources/systemcheck/test.json").success(function(){b.runMimeTypeTest(b.fileTypes,a,0,[])}).fail(function(){b.errorCode=c.ERR_FILE_DELIVERY;b.errorString="json";a(!1)})};this.runMimeTypeTest=function(a,b,g,h){var e=this;if(a.length)try{var d=a.pop(),j={type:d[0],expected:d[1],optional:d[2]||!1};h.push(j);$.ajax("resources/systemcheck/test."+d[0],{cache:!1,success:function(c,f,k){j.delivered=k.getResponseHeader("Content-Type");j.delivered.startsWith(d[1])?e.runMimeTypeTest(a,
b,g,h):j.optional?(console&&console.warn("Mime type for "+j.type+" is "+j.delivered+" instead of "+j.expected+" - content may not work properly"),e.runMimeTypeTest(a,b,g,h)):e.runMimeTypeTest(a,b,g+1,h)},error:function(){e.runMimeTypeTest(a,b,g+1,h)}})}catch(f){e.runMimeTypeTest(a,b,g+1,h)}else 0<g?(e.errorCode=c.ERR_FILE_DELIVERY,e.errorString=d,e.redirect="serverconfig.html",e.params=JSON.stringify(h),b(!1)):b(!0)}}f.ErrorCodes={ERR_NOERROR:0,ERR_ECMASCRIPT_SUPPORT:1,ERR_HTML5_SUPPORT:2,ERR_FILE_ACCESS:3,
ERR_SERVER_CONFIG:4,ERR_FILE_DELIVERY:5};f.prototype.fileTypes=[["svg","image/svg+xml"],["m4a","audio/mp4"],["ogg","audio/ogg"],["mp4","video/mp4"],["webm","video/webm"],["woff","application/font-woff",!0]];f.prototype.modernizrFeatures={canvas:"HTML5 Canvas",svg:"SVG (Scalable Vector Graphics)",inlinesvg:"SVG (Scalable Vector Graphics)",audio:"HTML5 Audio",video:"HTML5 Video",csstransforms:"CSS Transforms",fontface:"Webfonts"};var d=new f;$(document).ready(function(){/^.*skipcheck.*/.test(window.location.search)?
$(window).trigger("imc:playerReady"):d.run(function(c){c?$(window).trigger("imc:playerReady"):(d.redirect&&(c=d.redirect,d.params&&(c+="?data="+encodeURIComponent(d.params)),window.location="resources/systemcheck/"+c),console.warn("Systemcheck failed (Code "+d.errorCode+")"))})})})();
